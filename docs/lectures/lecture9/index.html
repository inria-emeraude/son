<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://inria-emeraude.github.io/son/lectures/lecture9/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title> 9: Some other usefull things to know  - SON @ INSA Lyon</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/rainbow.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">SON @ INSA Lyon</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Lectures</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../lecture1/" class="dropdown-item"> 1: Programming Environment Setup </a>
</li>
                                    
<li>
    <a href="../lecture2/" class="dropdown-item"> 2: Audio Signal Processing Fundamentals </a>
</li>
                                    
<li>
    <a href="../lecture3/" class="dropdown-item"> 3: Digital Audio Systems Architectures and Audio Callback </a>
</li>
                                    
<li>
    <a href="../lecture4/" class="dropdown-item"> 4: Hardware Control and Audio Codec Configuration </a>
</li>
                                    
<li>
    <a href="../lecture5/" class="dropdown-item"> 5: Introduction to Faust </a>
</li>
                                    
<li>
    <a href="../lecture6/" class="dropdown-item"> 6: Audio Processing Basics I </a>
</li>
                                    
<li>
    <a href="../lecture7/" class="dropdown-item"> 7: Audio Processing Basics II </a>
</li>
                                    
<li>
    <a href="../lecture8/" class="dropdown-item"> 8: Faust on the Teensy and Advanced Control </a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page"> 9: Some other usefull things to know </a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../projects/" class="nav-link">Projects</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/inria-emeraude/son" class="nav-link">Code</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../lecture8/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../projects/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#lecture-9-some-other-usefull-things-to-know" class="nav-link">Lecture 9: Some other usefull things to know</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#playing-wav-file-on-the-teensy-with-the-sd-card" class="nav-link">Playing WAV file on the teensy with the SD-card</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#streaming-sound-from-through-usb" class="nav-link">Streaming Sound from through USB</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#microphone-how-to-solder-it" class="nav-link">microphone: how to solder it</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#using-line-in-instead-of-microphone" class="nav-link">Using line in instead of microphone</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#use-a-midi-keayboard-or-controller" class="nav-link">Use a MIDI keayboard or controller</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#midi-controller-through-the-pc-not-directly" class="nav-link">Midi controller through the PC, not directly.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#note-frequency-identification" class="nav-link">Note Frequency identification</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="3"><a href="#faust-eftranspose-function" class="nav-link">FAUST ef.transpose() function.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#fft-or-not-fft" class="nav-link">FFT or not FFT</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="lecture-9-some-other-usefull-things-to-know">Lecture 9: Some other usefull things to know</h1>
<p>This page gathered information that are useful to many of you (but not all of you probably), depending on the topic of your project. Many of your realization are prototyped in existing examples in the arduino IDE.</p>
<h2 id="playing-wav-file-on-the-teensy-with-the-sd-card">Playing WAV file on the teensy with the SD-card</h2>
<p>If you want to play sound file, two possibilities:</p>
<ol>
<li>Use the USB-IN to stream audio from the computer (explained after) but you have no control on the file streamed from the teensy</li>
<li>Store WAV files on the SD-Card and read them with the <code>AudioPlaySdWav</code> object.</li>
</ol>
<p>An example explaining how to use the SD-card reader  can be found in <code>file -&gt; examples -&gt; Audio -&gt;&gt; WaveFilePlayer</code> </p>
<p>Be careful to use the WAV file provided by teensy (https://www.pjrc.com/teensy/td_libs_AudioDataFiles.html) because some arbitraty WAV file may be not compatible with the on the AudioPlaySdWav player.</p>
<h2 id="streaming-sound-from-through-usb">Streaming Sound from through USB</h2>
<p>TODO</p>
<h2 id="microphone-how-to-solder-it">microphone: how to solder it</h2>
<p>If your microphone has no JACK input port, you have to solder it. Microphone are stereo but the teensy input microphone is mono. The soldering of the JACK microphone is quite touchy. please get in touch with Teachers.
TODO</p>
<h2 id="using-line-in-instead-of-microphone">Using line in instead of microphone</h2>
<p>For some usage, for a guitar pedal effect for instance, the microphone (which is amplified) might be to sensitive for a "Line" signal such as the one getting out of a guitar. In reducing the microphone gain is not sufficient to eliminate saturation, you can use the "Line IN" port (port printed out below the audio shield) to solder another JACK adaptor.</p>
<h2 id="use-a-midi-keayboard-or-controller">Use a MIDI keayboard or controller</h2>
<p>Many of you will want to use a midi controler (midi keyboard for instance) to control the teensy. A very simple way to do that is to use a <em>virtual midi keyboard</em> that will emulate a MIDI keybard on you computer and send midi signal to the teensy through the MIDI-USB interface.</p>
<ol>
<li>
<p>A very common virtual MIDI keyboard is vmpk (https://vmpk.sourceforge.io/), it works on Linux, Windows and Mac.</p>
</li>
<li>
<p>In the arduino IDE, you will have to configure the USB-Type: <code>tools -&gt; USB-type -&gt; "MIDI+Serial"</code></p>
</li>
<li>
<p>There are many MIDI-USB example in the IDE, you can start with <code>Files -&gt; Examples -&gt; Teensy -&gt; USB_MIDI -&gt; InputFunctionBasic</code></p>
</li>
<li>
<p>Once the program running in the Teensy, you can launch the virtual keyboard  and select <code>Edit -&gt; MIDI Connexions -&gt;  ouptut port connexions -&gt; Teensy MIDI</code></p>
</li>
<li>
<p>Be aware that, on some systems, you will have to restart the virtual keyboard <em>each time</em> you reprogram the Teensy.</p>
</li>
</ol>
<h2 id="midi-controller-through-the-pc-not-directly">Midi controller through the PC, not directly.</h2>
<p>Once you have debugged your program with the virtual keyboard, you can plug a real (physical) MIDI keyboard to your computer and use your computer to transmit MIDI signal to the teensy with MIDI-USB. </p>
<h2 id="note-frequency-identification">Note Frequency identification</h2>
<p>Many application will require to identify the fundamental frequency of a sound (i.e. the note of the sound). There are many ways to do that, one can use a FFT and identify the note on the spectrum. However, as we will see below, FFT is quite a heavy computationnal program and it is complicated to set-up.</p>
<p>A simple way to do that in C++ is to use the <code>Note Frequency</code> example in the arduino IDE (<code>File -&gt; Examples -&gt; Audio -&gt; Analysis -&gt; NoteFrequency</code>)</p>
<h3 id="faust-eftranspose-function">FAUST <code>ef.transpose()</code> function.</h3>
<p>The ef.transpose function is often useful, however, it uses too much memory to run on the teensy. You can still use this function but you have to</p>
<ol>
<li>
<p>copy the code of the transpose function (in the library github site, <code>misceffect.lib</code> file) in your faust program</p>
</li>
<li>
<p>modify the line <code>maxDelay = 65536;</code> to <code>maxDelay = 1024</code></p>
</li>
<li>
<p>Change <code>ef.transpose</code> by <code>transpose</code></p>
</li>
<li>
<p>Set the first parameter of <code>transpose</code> to 1000.</p>
</li>
</ol>
<p>Then you should be able to export your program to Tennsy.</p>
<h3 id="fft-or-not-fft">FFT or not FFT</h3>
<p>The Fourier transform is a powerful tool for many audio effect. However FFT is quite heavy computationnaly and difficult to set up so one must be aware that it will take some time to setup.</p>
<p>FFT in Faust in <strong>not working</strong>. There is a FFT Faust program but it is called at each sample which is unrealistic (i.e. uses to much computing power).</p>
<p>There is a  <code>AudioAnalyzeFFT1024</code> object in the teensy Audio library that  Compute a 1024 point Fast Fourier Transform  frequency analysis, with real value output. It is mainly used for spectral visualization. The example <code>File -&gt; Examples -&gt; Audio -&gt; Analysis -&gt; FFT</code> can be easily adapted to analyze the spectrum of the sound comming from the microphone (by default, it uses the line input).</p>
<p>However, this object should be used in the loop of the <code>.ino</code> file. it will be too heavy to be used in the update function. Another point is that there is no example with a inverse FFT, there existe an inverse FFT function, but it cannor really by used to reconstruct the signal because it is not precise enough.</p>
<p>Hence, at that point, FFT can be used for visualisation but not really to perform frequency domain sound transformations.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
